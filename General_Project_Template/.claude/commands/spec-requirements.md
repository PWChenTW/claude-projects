# 需求分析階段

執行BDD(行為驅動開發)需求分析，將功能描述轉換為具體的業務需求和測試場景。

## 用法
`/spec-requirements [功能名稱]`

## 功能說明

這個命令會自動：

1. **調用business-analyst** (強制委派)
   - **必須**委派給 `business-analyst`，禁止主助手直接分析
   - 深入分析業務需求
   - 識別關鍵使用場景
   - 評估技術可行性
   - 應用批判性思考，質疑需求合理性

2. **生成BDD文檔**
   - 創建Gherkin格式的場景
   - 定義驗收標準
   - 識別邊界條件和異常情況

3. **輸出需求文檔**
   - 保存到 `.kiro/specs/[feature-name]/requirements.md`
   - 更新規格狀態為 `design`
   - 執行任務記錄：`python .claude/scripts/update_task_log.py`

## BDD需求分析流程

### 1. 業務目標分析
- 理解功能的商業價值
- 識別主要受益者
- 定義成功標準

### 2. 場景識別
- 正常使用場景
- 邊界條件場景
- 錯誤處理場景
- 性能要求場景

### 3. 驗收標準定義
- 功能性要求
- 非功能性要求（性能、安全、可用性）
- 風險控制要求
- 合規性要求

## 輸出格式

生成的 `requirements.md` 包含：

```markdown
# [功能名稱] 需求分析

## 業務目標
- 目標：[具體目標]
- 價值：[商業價值]
- 成功標準：[衡量標準]

## 主要場景

### Feature: [功能名稱]
作為[角色]
我希望[功能]
以便[價值]

#### Background:
Given [前置條件]
And [環境設置]

#### Scenario: [正常場景]
Given [給定條件]
When [執行動作]
Then [預期結果]
And [額外驗證]

#### Scenario: [邊界場景]
Given [邊界條件]
When [觸發動作]
Then [處理結果]

#### Scenario: [異常場景]
Given [異常條件]
When [異常觸發]
Then [錯誤處理]

## 非功能性需求
- 性能要求：[具體指標]
- 可用性要求：[可用性標準]
- 安全要求：[安全標準]
- 風控要求：[風險控制]

## 風險評估
- 技術風險：[風險點]
- 業務風險：[業務風險]
- 緩解措施：[應對方案]

## 驗收標準
- [ ] [標準1]
- [ ] [標準2]
- [ ] [標準3]
```

## 示例

```bash
> /spec-requirements user-auth
```

會調用 `business-analyst` 分析用戶認證需求，生成包含以下場景的BDD文檔：
- 用戶註冊場景
- 用戶登入場景
- 權限驗證場景
- 錯誤處理場景

## 質量檢查

需求分析完成後會自動檢查：
- [ ] 所有主要場景都有覆蓋
- [ ] 驗收標準明確可測
- [ ] 風險點已識別
- [ ] 非功能需求已定義

## 人工審核點

在進入設計階段前，需要確認：
1. 業務需求理解正確
2. 場景覆蓋完整
3. 驗收標準可行
4. 風險評估合理

通過審核後使用 `/spec-design [功能名稱]` 進入下一階段。