# 上下文工程原則

## 核心哲學

「上下文為王」- 全面的上下文能帶來更好的 AI 輔助開發。上下文工程與提示工程有根本性的不同：我們不是專注於巧妙的措辭，而是提供完整的系統來提供全面的上下文。

## 關鍵原則

### 1. 全面上下文優於巧妙提示
- 預先提供完整資訊
- 包含範例、模式和反模式
- 參考現有程式碼和文檔
- 定義明確的成功標準

### 2. 漸進式開發
- 從最簡單的可運作版本開始
- 驗證每個增量
- 根據回饋進行增強
- 全程維護上下文

### 3. 驗證驅動方法
- 在實作前定義成功標準
- 在每個階段創建驗證關卡
- 盡可能使用自動化檢查
- 根據驗證結果進行迭代

## 實作指南

### 功能上下文需求

每個功能必須具備：

1. **明確的規格說明** (`INITIAL.md`)
   - 明確的功能描述
   - 使用者故事和使用案例
   - 技術需求
   - 約束和限制

2. **實作範例** (`docs/examples/`)
   - 程式碼庫中的類似模式
   - 展示方法的程式碼片段
   - 要避免的反模式
   - 要遵循的最佳實踐

3. **外部參考**
   - API 文檔連結
   - 函式庫參考
   - 學術論文（演算法相關）
   - 產業標準

4. **驗證標準**
   - 單元測試需求
   - 整合測試場景
   - 性能基準
   - 安全需求

### 上下文組裝流程

1. **研究階段**
   ```
   - 搜尋現有程式碼庫中的模式
   - 審查文檔和範例
   - 識別潛在挑戰
   - 收集外部資源
   ```

2. **文檔階段**
   ```
   - 撰寫清晰的需求
   - 創建實作藍圖
   - 記錄驗證標準
   - 添加範例和參考
   ```

3. **驗證階段**
   ```
   - 執行上下文驗證器
   - 確保最低 75% 的上下文分數
   - 解決缺失的元素
   - 獲得利害關係人批准
   ```

## 品質關卡

### 實作前檢查

開始實作前，確保：

- [ ] INITIAL.md 完整包含所有 4 個部分
- [ ] docs/examples/ 中存在範例或已參考
- [ ] 已創建實作藍圖 (PRP)
- [ ] 已完成 ULTRATHINK 分析
- [ ] 上下文驗證分數 ≥ 75%

### 實作期間

- [ ] 遵循已識別的現有模式
- [ ] 經常參考文檔
- [ ] 定期根據標準進行驗證
- [ ] 隨著學習更新上下文

### 實作後

- [ ] 符合所有驗證標準
- [ ] 測試涵蓋已識別的邊緣案例
- [ ] 文檔已更新
- [ ] 模式已添加到範例（如果是新穎的）

## 工具和命令

### 上下文工程命令

1. **生成 PRP** (`/spec-generate-prp`)
   - 創建實作藍圖
   - 組裝全面的上下文
   - 包含驗證標準

2. **ULTRATHINK** (`/spec-ultrathink`)
   - 編碼前的深度分析
   - 風險評估
   - 任務分解
   - 實作策略

3. **上下文驗證**
   ```bash
   python .claude/scheduler/context_validator.py [功能名稱]
   ```
   - 驗證上下文完整性
   - 提供改進建議
   - 執行最低標準

## 最佳實踐

### 應該做的：
- 預先提供完整的上下文
- 包含多個範例
- 參考權威來源
- 定義明確的驗證標準
- 隨著學習更新上下文
- 使用結構化格式 (INITIAL.md)

### 不應該做的：
- 依賴 AI「自己搞清楚」
- 跳過文檔參考
- 忽略現有模式
- 在沒有上下文的情況下開始編碼
- 使用模糊的需求
- 跳過驗證步驟

## 上下文評分

功能在四個維度上評分（每個 25 分）：

1. **範例** - 程式碼範例和模式
2. **文檔** - 外部參考和指南
3. **模式** - 實作方法
4. **驗證** - 成功標準和測試

最低可行上下文分數：**75/100**

## 演進和維護

### 持續改進
- 發現新模式時添加
- 用更好的方法更新範例
- 根據經驗改進驗證標準
- 記錄學到的教訓

### 知識保存
- 捕捉實作決策
- 記錄選擇某些方法的原因
- 添加開發過程中發現的邊緣案例
- 創建可重用的模式

## 與 AI 助理的整合

與 AI 助理合作時：

1. **首先提供完整上下文**
   - 分享 INITIAL.md
   - 參考範例目錄
   - 包含實作藍圖
   - 分享 ULTRATHINK 分析

2. **透過驗證進行迭代**
   - AI 根據上下文實作
   - 根據標準驗證
   - 提供回饋
   - AI 改進實作

3. **維護上下文線索**
   - 保持上下文一致
   - 隨著需求變更更新
   - 記錄做出的決策
   - 保存供未來參考

## 衡量成功

### 指標
- 實作時間減少
- 所需迭代次數減少
- 首次成功率提高
- 程式碼品質更好
- 歧義減少

### 回饋循環
- 追蹤哪些上下文效果最好
- 識別缺失的上下文模式
- 持續改進模板
- 在團隊中分享學習成果

記住：**更多上下文 = 更好的實作 = 更少的重工**