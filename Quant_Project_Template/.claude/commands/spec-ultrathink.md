# ULTRATHINK 實作規劃

使用上下文工程原則，在實作前進行深度分析和規劃。

## 概述

ULTRATHINK 是一個全面的實作前分析流程，確保在編寫任何程式碼之前進行徹底的理解和規劃。它將模糊的需求轉換為具體、可執行的實作計畫。

## 流程

### 1. **全面理解**
- 閱讀 `.kiro/specs/{功能}/` 中所有相關規格
- 分析 INITIAL.md 以了解功能上下文
- 理解 `.kiro/steering/` 中的架構約束
- 識別依賴關係和系統影響
- 繪製使用者工作流程和邊緣案例

### 2. **模式識別**
- 分析現有程式碼庫模式
- 在 `docs/examples/` 中搜尋類似實作
- 識別可重用的元件和工具
- 對應已實作的類似功能
- 記錄要避免的反模式

### 3. **風險評估**
- 識別潛在的故障點
- 分析安全影響
- 考慮性能瓶頸
- 規劃錯誤處理策略
- 記錄邊緣案例和極端情況
- 評估技術債務影響

### 4. **任務分解**
- 將功能分解為原子化、可測試的單元
- 為每個任務定義明確的驗收標準
- 建立驗證檢查點
- 創建任務之間的依賴關係圖
- 估計每個任務的複雜度和時間

### 5. **實作策略**
- 選擇最佳實作方法
- 選擇適當的設計模式
- 規劃增量交付里程碑
- 定義漸進推出的功能開關
- 記錄回滾策略
- 創建監控和警報計畫

## 輸出格式

儲存為 `.kiro/specs/{功能名稱}/ultrathink_analysis.md`：

```markdown
# ULTRATHINK 分析：{功能名稱}

## 執行摘要
- **功能**：{簡要描述}
- **複雜度分數**：{1-10}
- **風險等級**：{低/中/高}
- **預估時間**：{時間估計}
- **信心等級**：{1-10}

## 深度理解

### 功能上下文
- **使用者故事**：作為[使用者]，我想要[功能]，以便[利益]
- **商業價值**：{為什麼這很重要}
- **技術影響**：{受影響的系統}

### 依賴關係
- **內部依賴**：
  - 模組 A：{如何使用}
  - 模組 B：{整合點}
- **外部依賴**：
  - 函式庫 X：{版本、用途}
  - 服務 Y：{API、約束}

## 模式分析

### 要遵循的現有模式
1. **模式名稱**：{程式碼庫中的位置}
   - 為什麼適用：{理由}
   - 如何調整：{需要的修改}

### 要避免的反模式
1. **反模式**：{描述}
   - 為什麼要避免：{造成的問題}
   - 更好的方法：{替代方案}

## 風險分析

### 技術風險
| 風險 | 機率 | 影響 | 緩解措施 |
|------|------|------|----------|
| {風險 1} | 高/中/低 | 高/中/低 | {策略} |

### 安全考量
- [ ] 需要輸入驗證
- [ ] 身份驗證檢查
- [ ] 授權規則
- [ ] 資料加密需求
- [ ] 稽核日誌

## 實作分解

### 階段 1：基礎（第 1-2 天）
**目標**：建立基本結構和介面

1. **任務 1.1**：創建基礎類別
   - 驗收：類別編譯通過，測試通過
   - 依賴：無
   - 複雜度：低

2. **任務 1.2**：定義介面
   - 驗收：API 契約已定義
   - 依賴：任務 1.1
   - 複雜度：低

### 階段 2：核心邏輯（第 3-5 天）
**目標**：實作主要功能

[類似分解...]

### 階段 3：整合（第 6-7 天）
**目標**：將功能連接到現有系統

[類似分解...]

## 驗證策略

### 單元測試
- 測試覆蓋率目標：90%
- 關鍵測試場景：
  1. 正常路徑
  2. 錯誤條件
  3. 邊緣案例
  4. 性能限制

### 整合測試
- API 端點測試
- 資料庫互動測試
- 外部服務模擬

### 使用者驗收測試
- 場景 1：{描述}
- 場景 2：{描述}

## 推出計畫

### 功能開關
```json
{
  "feature_name_enabled": false,
  "feature_name_percentage": 0,
  "feature_name_user_list": []
}
```

### 監控
- 要追蹤的指標：
  - 回應時間 p95
  - 錯誤率
  - 使用模式
- 要配置的警報：
  - 錯誤率 > 1%
  - 回應時間 > 500ms

### 回滾程序
1. 停用功能開關
2. 還原資料庫遷移（如果有）
3. 清除快取
4. 通知利害關係人

## 待解決問題
1. **問題**：{未解決的議題}
   - 影響：{什麼被阻擋}
   - 詢問對象：{利害關係人}

## 後續步驟
1. 與技術主管審查分析
2. 獲得方法批准
3. 設置開發環境
4. 開始階段 1 實作
```

## 使用範例

```
/spec-ultrathink user-authentication

這將會：
1. 對身份驗證需求進行深度分析
2. 研究程式碼庫中現有的身份驗證模式
3. 識別風險並規劃緩解措施
4. 創建詳細的任務分解
5. 將分析儲存到 .kiro/specs/user-authentication/ultrathink_analysis.md
```

## 優勢

- **減少重工**：在編碼開始前發現問題
- **更好的估計**：準確的複雜度評估
- **風險緩解**：主動識別問題
- **知識轉移**：為未來參考的文檔
- **建立信心**：清晰的前進道路