---
name: verify
description: 驗證階段 - 確保實作符合需求和品質標準
---

# 驗證命令 (Verify Command)

## 命令用途

`/verify [feature]` - 全面驗證實作成果，確保符合需求、品質標準和預期目標。

## 核心理念

> "Trust, but verify" - 信任，但要驗證

驗證不只是測試，而是全方位確認我們交付了正確的、高品質的解決方案。

## 觸發時機

### 自動觸發
- 完成 `/execute` 的每個里程碑後
- 提交 PR 前自動執行
- 部署前的最終檢查

### 手動觸發
```bash
/verify authentication     # 驗證認證功能
/verify --full             # 完整驗證
/verify --quick            # 快速驗證
/verify --regression       # 迴歸測試
```

## 工作流程

### 階段 1：功能驗證 (10-15 分鐘)
```bash
1. 需求符合度檢查
   - 對照原始需求
   - 檢查功能完整性
   - 驗證業務邏輯

2. 使用場景測試
   - 正常流程測試
   - 邊界條件測試
   - 異常情況處理

3. 用戶體驗驗證
   - 介面友好性
   - 錯誤提示清晰度
   - 性能響應時間
```

### 階段 2：技術驗證 (10-15 分鐘)
```bash
1. 代碼品質檢查
   - 靜態代碼分析
   - 代碼規範檢查
   - 複雜度分析

2. 測試覆蓋驗證
   - 單元測試覆蓋率
   - 整合測試完整性
   - E2E 測試通過率

3. 性能和安全
   - 性能基準測試
   - 安全漏洞掃描
   - 資源使用分析
```

### 階段 3：整合驗證 (5-10 分鐘)
```bash
1. 系統整合測試
   - API 契約驗證
   - 資料流驗證
   - 依賴相容性

2. 迴歸測試
   - 現有功能影響
   - 向後相容性
   - 資料遷移驗證

3. 部署就緒檢查
   - 配置完整性
   - 文檔更新
   - 發布準備
```

## 驗證檢查清單

### 必須通過項目 (P0)
```markdown
- [ ] 所有需求已實現
- [ ] 所有測試通過
- [ ] 無關鍵錯誤
- [ ] 安全檢查通過
- [ ] 文檔已更新
```

### 應該通過項目 (P1)
```markdown
- [ ] 代碼覆蓋率 > 80%
- [ ] 性能達到基準
- [ ] 代碼規範符合
- [ ] 無新增警告
- [ ] API 文檔完整
```

### 建議改進項目 (P2)
```markdown
- [ ] 代碼複雜度優化
- [ ] 測試執行時間優化
- [ ] 重複代碼消除
- [ ] 依賴更新
- [ ] 性能進一步優化
```

## 輸出格式

### 驗證報告模板
```markdown
# 驗證報告 - [功能名稱]
日期：[YYYY-MM-DD]
驗證者：Claude Code

## 驗證摘要
**總體結果**: ✅ 通過 / ⚠️ 部分通過 / ❌ 未通過

### 關鍵指標
| 指標 | 目標 | 實際 | 狀態 |
|------|------|------|------|
| 功能完成度 | 100% | 100% | ✅ |
| 測試覆蓋率 | >80% | 92% | ✅ |
| 性能響應 | <200ms | 150ms | ✅ |
| 安全掃描 | 0 高危 | 0 高危 | ✅ |

## 功能驗證
### 需求實現情況
- [x] 需求 1: 用戶註冊
- [x] 需求 2: 郵箱驗證
- [x] 需求 3: 密碼重置
- [x] 需求 4: 雙因素認證

### 測試執行結果
```
單元測試: 45/45 passed
整合測試: 12/12 passed
E2E 測試: 8/8 passed
總執行時間: 4.2s
```

### 使用場景驗證
| 場景 | 預期結果 | 實際結果 | 狀態 |
|------|----------|----------|------|
| 正常註冊 | 成功建立帳號 | ✓ | ✅ |
| 重複郵箱 | 顯示錯誤提示 | ✓ | ✅ |
| 弱密碼 | 拒絕並提示 | ✓ | ✅ |

## 技術驗證
### 代碼品質
```
Linting: 0 errors, 0 warnings
複雜度: 平均 3.2 (良好)
重複率: 2.1% (優秀)
技術債: 0.5 天
```

### 性能測試
```
API 響應時間:
- 註冊: 120ms (p95)
- 登入: 80ms (p95)
- 驗證: 50ms (p95)

資源使用:
- CPU: <5%
- Memory: 128MB
- Database: 10 連接
```

### 安全檢查
```
OWASP Top 10: ✅ 全部通過
依賴漏洞: 0 高危, 0 中危, 2 低危
密碼策略: ✅ 符合標準
加密實施: ✅ 正確
```

## 問題和建議
### 發現的問題
1. **問題**: 郵件發送偶爾延遲
   - 嚴重性: 低
   - 建議: 實施佇列機制

2. **問題**: 測試資料清理不完整
   - 嚴重性: 低
   - 建議: 改進測試 teardown

### 改進建議
1. **性能**: 考慮添加 Redis 快取
2. **安全**: 實施速率限制
3. **監控**: 添加更多指標

## 驗證結論
### ✅ 通過項目
- 功能需求 100% 實現
- 所有測試通過
- 性能符合要求
- 安全檢查通過

### ⚠️ 注意項目
- 郵件發送需要優化
- 測試清理需要改進

### 下一步行動
- [ ] 修復郵件延遲問題
- [ ] 改進測試框架
- [ ] 準備部署文檔
- [ ] 進行用戶驗收測試

## 簽核
- 開發完成: ✅
- 測試通過: ✅
- 代碼審查: ✅
- 準備部署: ✅

**建議**: 可以進入部署階段
```

## 輸出位置

驗證結果保存到：
- `.kiro/reports/verification/[date]-[feature].md` - 驗證報告
- `.kiro/specs/[feature]/verification.md` - 功能驗證記錄
- `.kiro/quality/[date]-metrics.md` - 品質指標

## 與其他命令的關係

```mermaid
graph LR
    C[/execute] --> D[/verify]
    D --> E{通過?}
    E -->|是| F[/deploy]
    E -->|否| G[/fix]
    G --> C
    D --> H[/report]
```

- **前置命令**: 需要先執行 `/execute`
- **後續命令**: 通過後可執行 `/deploy`
- **失敗處理**: 未通過時返回 `/execute` 修復

## 驗證策略

### 分層驗證
```markdown
1. 單元層：快速、隔離、大量
2. 整合層：中速、交互、適量
3. E2E 層：慢速、完整、少量
```

### 風險導向
```markdown
優先驗證：
1. 高風險功能
2. 核心業務邏輯
3. 用戶關鍵路徑
4. 新增/修改部分
```

### 持續驗證
```markdown
- 開發時：單元測試
- 提交時：整合測試
- 部署前：完整驗證
- 部署後：監控驗證
```

## 成功指標

成功的驗證應該：
- ✅ 覆蓋所有需求點
- ✅ 包含正向和負向測試
- ✅ 有清晰的通過標準
- ✅ 提供可操作的反饋
- ✅ 可重複執行

## 注意事項

### ⚠️ 避免的陷阱
- 只測試正向路徑
- 忽略性能驗證
- 跳過安全檢查
- 驗證不夠全面

### 💡 最佳實踐
- 自動化驗證流程
- 建立驗證基準
- 保存驗證記錄
- 持續改進標準

## 範例使用

### 場景 1：里程碑驗證
```bash
User: Phase 1 開發完成了
Assistant: 開始驗證 Phase 1 的實作...

/verify phase-1

[執行功能測試]
[執行技術驗證]
[生成驗證報告]

✅ Phase 1 驗證通過！
- 功能完成度: 100%
- 測試覆蓋率: 94%
- 性能達標: ✓
- 安全檢查: ✓

可以繼續 Phase 2 的開發。
```

### 場景 2：問題發現
```bash
執行驗證中...

⚠️ 驗證發現問題：
1. 測試覆蓋率不足 (75% < 80%)
2. API 響應超時 (320ms > 200ms)

建議修復方案：
1. 添加缺失的邊界測試
2. 優化資料庫查詢

是否要自動修復這些問題？
```

### 場景 3：部署前驗證
```bash
User: 準備部署到生產環境
Assistant: 執行部署前完整驗證...

/verify --full --production

[功能迴歸測試]
[性能壓力測試]
[安全滲透測試]
[相容性檢查]

✅ 生產部署驗證通過！
所有檢查項目符合生產標準。

部署檢查清單：
✓ 功能測試: 156/156
✓ 性能基準: 達標
✓ 安全掃描: 清潔
✓ 文檔更新: 完成
✓ 回滾計畫: 就緒

可以安全部署。
```

## 配置選項

在 `.claude/settings.json` 中配置：
```json
{
  "verify": {
    "auto_verify": true,
    "coverage_threshold": 80,
    "performance_baseline": {
      "api_response": 200,
      "page_load": 1000
    },
    "security_scan": true,
    "require_documentation": true,
    "regression_test": true
  }
}
```

---

記住：**驗證是品質的最後防線**。寧可過度驗證，也不要讓問題流入生產環境。